 // filepath: src/components/SignUp.jsx
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import '../App.css';

function generateStudentId() {
  return 'BVC' + Math.random().toString(36).slice(2, 8).toUpperCase();
}

function loadUsers() {
  try {
    const raw = localStorage.getItem('users');
    return raw ? JSON.parse(raw) : [];
  } catch {
    return [];
  }
}

function saveUsers(users) {
  localStorage.setItem('users', JSON.stringify(users));
}

export default function SignUp({ setUser }) {
  const navigate = useNavigate();
  const [form, setForm] = useState({
    firstName: '',
    lastName: '',
    email: '',
    phone: '',
    birthday: '',
    department: 'SD',
    program: '',
    username: '',
    password: ''
  });
  const [error, setError] = useState('');

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm(prev => ({ ...prev, [name]: value }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    // Basic check: username unique
    const users = loadUsers();
    if (users.find(u => u.username === form.username)) {
      setError('Username already exists');
      return;
    }
    const studentId = generateStudentId();
    const newUser = { ...form, studentId, isAdmin: false };
    users.push(newUser);
    saveUsers(users);
    localStorage.setItem('currentUser', JSON.stringify(newUser));
    if (setUser) setUser(newUser);
    navigate('/dashboard');
  };

  return (
    <div className="signup-container">
      <h2>Student Registration</h2>
      {error && <div className="message error">{error}</div>}
      <form onSubmit={handleSubmit}>
        <div className="form-group">
          <input name="firstName" placeholder="First Name" value={form.firstName} onChange={handleChange} required />
        </div>
        <div className="form-group">
          <input name="lastName" placeholder="Last Name" value={form.lastName} onChange={handleChange} required />
        </div>
        <div className="form-group">
          <input name="email" type="email" placeholder="Email" value={form.email} onChange={handleChange} required />
        </div>
        <div className="form-group">
          <input name="phone" placeholder="Phone" value={form.phone} onChange={handleChange} required />
        </div>
        <div className="form-group">
          <input name="birthday" type="date" value={form.birthday} onChange={handleChange} required />
        </div>
        <div className="form-group">
          <select name="department" value={form.department} onChange={handleChange} required>
            <option value="SD">Software Development</option>
          </select>
        </div>
        <div className="form-group">
          <select name="program" value={form.program} onChange={handleChange} required>
            <option value="">Select Program</option>
            <option value="diploma">Diploma (2 years)</option>
            <option value="postDiploma">Post-Diploma (1 year)</option>
            <option value="certificate">Certificate (6 months)</option>
          </select>
        </div>
        <div className="form-group">
          <input name="username" placeholder="Username" value={form.username} onChange={handleChange} required />
        </div>
        <div className="form-group">
          <input name="password" type="password" placeholder="Password" value={form.password} onChange={handleChange} required />
        </div>
        <button type="submit">Register</button>
      </form>
    </div>
  );
}
